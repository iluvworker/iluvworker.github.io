name: Update posts.json
on:
  workflow_dispatch:
  push:
    paths:
      - 'posts.json'

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Git
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"

      - name: Check for pending updates
        run: |
          echo "ğŸ” posts.json ã®æ›´æ–°ãƒã‚§ãƒƒã‚¯ä¸­..."
          if [ -f posts.json ]; then
            echo "âœ… posts.json ãŒå­˜åœ¨ã—ã¾ã™"
          else
            echo "âš  posts.json ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
            exit 1
          fi

      - name: Commit & Push if changed
        run: |
          git add posts.json
          if git diff --cached --quiet; then
            echo "ğŸŸ¢ å¤‰æ›´ãªã—ã€‚ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚"
          else
            git commit -m "update posts.json via GitHub Actions"
            git push
            echo "ğŸš€ posts.json ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚"
          fi
